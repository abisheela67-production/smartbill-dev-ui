<div class="data-grid-container">
  <table class="table">
    <thead>
      <tr>
        <th
          *ngFor="let col of columns; let i = index"
          [style.width.px]="col.width"
          [class.no-upload]="!col.allowUploadFill"
          [title]="!col.allowUploadFill ? 'Upload disabled for this column' : ''"
        >
          <div class="th-content">
            {{ col.header }}
            <span
              *ngIf="allowUserToResizeColumns"
              class="resize-handle"
              (mousedown)="startResize($event, i)"
            ></span>
          </div>
        </th>
      </tr>
    </thead>

    <tbody>
      <tr
        *ngFor="let row of data; let r = index"
        [class.row-focused]="selectionMode === 'FullRowSelect' && focusedCell.row === r"
        (click)="selectionMode === 'FullRowSelect' ? focusCell(r, 0) : null"
      >
        <td
          *ngFor="let col of columns; let c = index"
          [class.focused]="focusedCell.row === r && focusedCell.col === c"
          [class.readonly]="col.readOnly"
          [class.no-upload]="!col.allowUploadFill"
          (click)="selectionMode !== 'FullRowSelect' ? focusCell(r, c) : null"
        >
          <ng-container [ngSwitch]="col.type">
            <!-- ðŸŸ¦ Text -->
            <input
              *ngSwitchCase="'text'"
              #gridInput
              type="text"
              class="cell-input"
              [(ngModel)]="row[col.field]"
              [readonly]="col.readOnly || (col.lockAfterUpload && row._uploaded)"
              [disabled]="col.readOnly"
              (click)="$event.stopPropagation()"
              (focus)="focusCell(r, c)"
              (keydown)="handleKeyDown($event, r, c)"
              autocomplete="off"
            />

            <!-- ðŸ”¢ Number -->
            <input
              *ngSwitchCase="'number'"
              #gridInput
              type="number"
              class="cell-input number"
              [(ngModel)]="row[col.field]"
              [readonly]="col.readOnly || (col.lockAfterUpload && row._uploaded)"
              [disabled]="col.readOnly"
              (click)="$event.stopPropagation()"
              (focus)="focusCell(r, c)"
              (keydown)="handleKeyDown($event, r, c)"
              autocomplete="off"
            />

            <!-- ðŸ“… Date -->
            <input
              *ngSwitchCase="'date'"
              #gridInput
              type="date"
              class="cell-input"
              [(ngModel)]="row[col.field]"
              [readonly]="col.readOnly || (col.lockAfterUpload && row._uploaded)"
              [disabled]="col.readOnly"
              (click)="$event.stopPropagation()"
              (focus)="focusCell(r, c)"
              (keydown)="handleKeyDown($event, r, c)"
            />

            <!-- â˜‘ï¸ Boolean -->
            <input
              *ngSwitchCase="'boolean'"
              #gridInput
              type="checkbox"
              class="cell-checkbox"
              [(ngModel)]="row[col.field]"
              [disabled]="col.readOnly || (col.lockAfterUpload && row._uploaded)"
              (click)="$event.stopPropagation()"
              (focus)="focusCell(r, c)"
              (keydown)="handleKeyDown($event, r, c)"
            />

            <!-- ðŸ”½ Select -->
            <select
              *ngSwitchCase="'select'"
              #gridInput
              class="cell-input"
              [(ngModel)]="row[col.field]"
              [disabled]="col.readOnly || (col.lockAfterUpload && row._uploaded)"
              (focus)="focusCell(r, c)"
              (keydown)="handleSelectKeyDown($event, r, c, gridInput)"
            >
              <option value="">-- Select --</option>
              <option
                *ngFor="let opt of parent[col.options]"
                [ngValue]="opt[col.optionValue]"
              >
                {{ opt[col.optionLabel] }}
              </option>
            </select>

            <!-- ðŸŸ¥ Default -->
            <input
              *ngSwitchDefault
              #gridInput
              type="text"
              class="cell-input"
              [(ngModel)]="row[col.field]"
              [readonly]="col.readOnly || (col.lockAfterUpload && row._uploaded)"
              [disabled]="col.readOnly"
              (click)="$event.stopPropagation()"
              (focus)="focusCell(r, c)"
              (keydown)="handleKeyDown($event, r, c)"
              autocomplete="off"
            />
          </ng-container>
        </td>
      </tr>
    </tbody>
  </table>
</div>
