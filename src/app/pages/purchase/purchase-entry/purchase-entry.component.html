<!-- ============================
     FULL PAGE WRAPPER
============================ -->
<div class="page-layout">
  <!-- üîô BACK + PAGE TITLE -->
  <div class="page-header-bar">
    <button class="btn btn-outline page-back-btn" (click)="goBack()">
      ‚Üê Back
    </button>
    <h2 class="page-title">Purchase Order Entry</h2>
  </div>

  <!-- ============================
         PURCHASE ORDER HEADER
  ============================= -->
  <div class="form-section">
    <span class="form-section-title">Purchase Order Header</span>

    <div class="form-grid-4">
      <!-- Accounting Year -->
      <div class="form-field">
        <label>Accounting Year</label>
        <input type="text" [value]="accountingYear" disabled />
      </div>

      <!-- Company -->
      <div class="form-field">
        <label class="required">Company Name</label>
        <select
          [(ngModel)]="selectedCompanyId"
          (ngModelChange)="onCompanyChange($event)"
          appFocusOnKey
          targetId="companyName"
          [autoFocus]="true"
        >
          <option *ngFor="let c of companies" [value]="c.companyID">
            {{ c.companyName }}
          </option>
        </select>
      </div>

      <!-- Branch -->
      <div class="form-field">
        <label class="required">Branch</label>
        <select
          [(ngModel)]="selectedBranchId"
          (ngModelChange)="applyTopSelectionsToGrid()"
          appFocusOnKey
          targetId="branchName"
        >
          <option [ngValue]="null">-- Select Branch --</option>
          <option *ngFor="let b of branches" [value]="b.branchID">
            {{ b.branchName }}
          </option>
        </select>
      </div>

      <!-- Supplier -->
      <div class="form-field">
        <label class="required">Supplier</label>
        <select
          [(ngModel)]="selectedSupplierId"
          (ngModelChange)="applyTopSelectionsToGrid()"
          appFocusOnKey
          targetId="supplierName"
        >
          <option [ngValue]="null">-- Select Supplier --</option>
          <option *ngFor="let s of suppliers" [value]="s.supplierID">
            {{ s.supplierName }}
          </option>
        </select>
      </div>

      <!-- Purchase Date -->
      <div class="form-field">
        <label class="required">Purchase Date</label>
        <input
          type="date"
          [(ngModel)]="selectedPurchaseDate"
          (ngModelChange)="applyTopSelectionsToGrid()"
          appFocusOnKey
          targetId="purchaseDate"
        />
      </div>

      <!-- Invoice Date -->
      <div class="form-field">
        <label>Invoice Date</label>
        <input
          type="date"
          [(ngModel)]="selectedInvoiceDate"
          (ngModelChange)="applyTopSelectionsToGrid()"
          appFocusOnKey
          targetId="invoiceDate"
        />
      </div>

      <!-- Payment Mode -->
      <div class="form-field">
        <label>Payment Mode</label>
        <select
          [(ngModel)]="selectedPaymentMode"
          appFocusOnKey
          targetId="paymentMode"
        >
          <option *ngFor="let pm of paymentModes" [value]="pm.paymentModeID">
            {{ pm.paymentModeName }}
          </option>
        </select>
      </div>

      <!-- Invoice No -->
      <div class="form-field">
        <label>Invoice No</label>
        <input
          type="text"
          [(ngModel)]="invoiceNo"
          appFocusOnKey
          targetId="invoiceNo"
        />
      </div>

      <!-- Supplier Invoice No -->
      <div class="form-field">
        <label>Supplier Invoice No</label>
        <input
          type="text"
          [(ngModel)]="supplierInvoiceNo"
          appFocusOnKey
          targetId="supplierInvoiceNo"
        />
      </div>
    </div>

    <!-- Validation -->
    <div *ngIf="validationLabel" class="validation-text">
      {{ validationLabel }}
    </div>

    <!-- Save Button -->
    <div class="form-actions">
      <button class="btn btn-primary">Save Purchase Order</button>
    </div>
  </div>

  <!-- ============================
            PURCHASE GRID
  ============================= -->
  <div class="form-section">
    <span class="form-section-title">Purchase Order Items</span>

    <!-- Small Popup Grid -->
    <div class="popup-grid" *ngIf="smallGridVisible">
      <button class="popup-close-btn" (click)="smallGridVisible = false">
        ‚úï
      </button>

      <app-small-grid
        [columns]="productGridColumns"
        [data]="smallGridData"
        (rowSelected)="onProductSelected($event)"
      ></app-small-grid>
    </div>

    <!-- Main Editable Grid -->
    <app-input-data-grid
      [columns]="visibleColumns"
      [data]="purchaseOrderEntries"
      (numberChanged)="onGridNumberChanged($event)"
      (rowAdded)="onGridRowAdded($event)"
      [parent]="{
        branches: branches,
        companies: companies,
        categories: categories,
        subCategories: subCategories,
        brands: brands,
        units: units,
        hsnCodes: hsnCodes,
        taxes: taxes,
        cesses: cesses,
        suppliers: suppliers,
        statuses: statuses,
        showSmallGrid: showSmallGrid.bind(this)
      }"
      selectionMode="FullRowSelect"
      [allowUserToAddRows]="true"
      [allowUserToDeleteRows]="true"
      [allowUserToResizeColumns]="true"
    ></app-input-data-grid>
  </div>
</div>
